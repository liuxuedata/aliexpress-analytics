<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ç«™ç‚¹ç®¡ç† Â· è·¨å¢ƒç”µå•†æ•°æ®åˆ†æå¹³å°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/login.css">
  <link rel="stylesheet" href="assets/theme.css?v=20250810b">
  <style>
    .site-management {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .site-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .site-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .site-card h3 {
      margin: 0 0 10px 0;
      color: #1f2937;
    }
    .site-card .platform {
      color: #6b7280;
      font-size: 14px;
      margin-bottom: 15px;
    }
    .site-card .actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .btn {
      padding: 8px 16px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover {
      background: #f9fafb;
    }
    .btn-primary {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    .btn-primary:hover {
      background: #2563eb;
    }
    .btn-danger {
      background: #ef4444;
      color: white;
      border-color: #ef4444;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    .add-site-form {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #374151;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
  </style>
</head>
<body class="fm">
<div id="loginOverlay" class="login-overlay" style="display:none">
  <div class="login-container">
    <div class="login-form-card login-card-enter">
      <div class="form-header">
        <div class="form-logo">AI</div>
        <div class="form-title">è·¨å¢ƒç”µå•†æ•°æ®åˆ†æå¹³å°</div>
        <div class="form-subtitle">ç™»å½•è´¦æˆ·ä»¥ç»§ç»­</div>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label" for="email">é‚®ç®±</label>
          <input id="email" type="email" class="form-input" required>
        </div>
        <div class="form-group password-input-wrapper">
          <label class="form-label" for="password">å¯†ç </label>
          <input id="password" type="password" class="form-input" required>
          <span id="password-toggle" class="password-toggle">ğŸ‘ï¸</span>
        </div>
        <button id="loginSubmit" class="login-submit-btn" type="submit">ç™»å½•</button>
      </form>
      <div class="demo-account-tip">
        <div class="demo-account-header">æ¼”ç¤ºè´¦æˆ·</div>
        <div class="demo-account-info">é‚®ç®±ï¼šdemo@example.com<br>å¯†ç ï¼šdemo123</div>
      </div>
    </div>
  </div>
</div>

<header class="header">
  <div class="logo-title">è·¨å¢ƒç”µå•†æ•°æ®åˆ†æå¹³å°</div>
  <nav class="header-center">
    <ul class="platform-nav">
      <li><a href="#">é€Ÿå–é€š</a>
        <ul class="dropdown">
          <li class="submenu"><a href="#">å…¨æ‰˜ç®¡</a>
            <ul id="managedMenu"></ul>
          </li>
          <li><a href="self-operated.html">è‡ªè¿è¥</a></li>
        </ul>
      </li>
      <li><a href="#">äºšé©¬é€Š</a></li>
      <li><a href="#">TikTok Shop</a></li>
      <li><a href="#">Temu</a></li>
      <li><a href="#">Ozon</a></li>
      <li><a href="independent-site.html">ç‹¬ç«‹ç«™</a></li>
    </ul>
  </nav>
  <div id="userArea" class="user-section"></div>
</header>

<div class="layout">
  <nav class="sidebar" id="sidebar">
    <div class="site-header"><span>ç«™ç‚¹ç®¡ç†</span></div>
    <ul class="sub-nav">
      <li><a href="#" class="active" data-target="sites">ç«™ç‚¹åˆ—è¡¨</a></li>
      <li><a href="#" data-target="add">æ·»åŠ ç«™ç‚¹</a></li>
    </ul>
  </nav>

  <main class="main mx-auto max-w-container px-6">
    <div class="site-management">
      <h1>ç«™ç‚¹ç®¡ç†</h1>
      
      <!-- æ·»åŠ ç«™ç‚¹è¡¨å• -->
      <div class="add-site-form">
        <h2>æ·»åŠ æ–°ç«™ç‚¹</h2>
        <form id="addSiteForm">
          <div class="form-row">
            <div class="form-group">
              <label for="siteName">ç«™ç‚¹åç§°</label>
              <input type="text" id="siteName" required placeholder="å¦‚ï¼šBç«™">
            </div>
            <div class="form-group">
              <label for="sitePlatform">å¹³å°</label>
              <select id="sitePlatform" required>
                <option value="">é€‰æ‹©å¹³å°</option>
                <option value="ae_self_operated">é€Ÿå–é€šè‡ªè¿è¥</option>
                <option value="independent">ç‹¬ç«‹ç«™</option>
                <option value="ae_managed">é€Ÿå–é€šå…¨æ‰˜ç®¡</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="displayName">æ˜¾ç¤ºåç§°</label>
            <input type="text" id="displayName" required placeholder="å¦‚ï¼šé€Ÿå–é€šè‡ªè¿è¥ Bç«™">
          </div>
          <button type="submit" class="btn btn-primary">æ·»åŠ ç«™ç‚¹</button>
        </form>
      </div>

      <!-- ç«™ç‚¹åˆ—è¡¨ -->
      <div id="sitesList">
        <h2>ç°æœ‰ç«™ç‚¹</h2>
        <div class="site-grid" id="siteGrid">
          <!-- ç«™ç‚¹å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
    </div>
  </main>
</div>

<script>
// ç™»å½•é€»è¾‘
(function() {
  const loginOverlay = document.getElementById('loginOverlay');
  const loginForm = document.getElementById('loginForm');
  const userArea = document.getElementById('userArea');

  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  function checkAuth() {
    const token = localStorage.getItem('authToken');
    if (!token) {
      loginOverlay.style.display = 'flex';
    } else {
      loginOverlay.style.display = 'none';
      userArea.innerHTML = `
        <span>æ¬¢è¿ï¼Œç”¨æˆ·</span>
        <button onclick="logout()" class="btn">é€€å‡º</button>
      `;
    }
  }

  // ç™»å½•å¤„ç†
  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    // æ¼”ç¤ºç™»å½•é€»è¾‘
    if (email === 'demo@example.com' && password === 'demo123') {
      localStorage.setItem('authToken', 'demo-token');
      checkAuth();
    } else {
      alert('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é‚®ç®±å’Œå¯†ç ');
    }
  });

  // é€€å‡ºç™»å½•
  window.logout = function() {
    localStorage.removeItem('authToken');
    checkAuth();
  };

  // å¯†ç æ˜¾ç¤ºåˆ‡æ¢
  document.getElementById('password-toggle').addEventListener('click', function() {
    const passwordInput = document.getElementById('password');
    passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
  });

  checkAuth();
})();

// ç«™ç‚¹ç®¡ç†é€»è¾‘
(function() {
  const addSiteForm = document.getElementById('addSiteForm');
  const siteGrid = document.getElementById('siteGrid');

  // åŠ è½½ç«™ç‚¹åˆ—è¡¨
  async function loadSites() {
    try {
      const response = await fetch('/api/sites');
      const result = await response.json();
      
      if (result.data) {
        renderSites(result.data);
      }
    } catch (error) {
      console.error('åŠ è½½ç«™ç‚¹å¤±è´¥:', error);
    }
  }

  // æ¸²æŸ“ç«™ç‚¹åˆ—è¡¨
  function renderSites(sites) {
    siteGrid.innerHTML = sites.map(site => `
      <div class="site-card">
        <h3>${site.display_name}</h3>
        <div class="platform">å¹³å°: ${getPlatformName(site.platform)}</div>
        <div class="platform">ç«™ç‚¹ID: ${site.name}</div>
        <div class="actions">
          <button class="btn" onclick="editSite('${site.id}')">ç¼–è¾‘</button>
          <button class="btn btn-danger" onclick="deleteSite('${site.id}')">åˆ é™¤</button>
        </div>
      </div>
    `).join('');
  }

  // è·å–å¹³å°åç§°
  function getPlatformName(platform) {
    const names = {
      'ae_self_operated': 'é€Ÿå–é€šè‡ªè¿è¥',
      'independent': 'ç‹¬ç«‹ç«™',
      'ae_managed': 'é€Ÿå–é€šå…¨æ‰˜ç®¡'
    };
    return names[platform] || platform;
  }

  // æ·»åŠ ç«™ç‚¹
  addSiteForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
      name: document.getElementById('siteName').value,
      platform: document.getElementById('sitePlatform').value,
      display_name: document.getElementById('displayName').value
    };

    try {
      const response = await fetch('/api/sites', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      });

      const result = await response.json();
      
      if (response.ok) {
        alert('ç«™ç‚¹æ·»åŠ æˆåŠŸï¼');
        addSiteForm.reset();
        loadSites();
      } else {
        alert('æ·»åŠ å¤±è´¥: ' + result.error);
      }
    } catch (error) {
      console.error('æ·»åŠ ç«™ç‚¹å¤±è´¥:', error);
      alert('æ·»åŠ ç«™ç‚¹å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  });

  // ç¼–è¾‘ç«™ç‚¹
  window.editSite = function(siteId) {
    // å®ç°ç¼–è¾‘åŠŸèƒ½
    alert('ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­...');
  };

  // åˆ é™¤ç«™ç‚¹
  window.deleteSite = function(siteId) {
    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç«™ç‚¹å—ï¼Ÿ')) {
      // å®ç°åˆ é™¤åŠŸèƒ½
      alert('åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...');
    }
  };

  // é¡µé¢åŠ è½½æ—¶è·å–ç«™ç‚¹åˆ—è¡¨
  loadSites();
})();
</script>
</body>
</html>
