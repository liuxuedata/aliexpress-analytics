<!doctype html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>运营分析</title>
  <link rel="stylesheet" href="assets/theme.css?v=20250812-deep">
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <script>const t=localStorage.getItem('theme');if(t)document.documentElement.setAttribute('data-theme',t);</script>
</head>
<body>
<header class="header">
  <div class="logo-title">跨境电商数据分析平台</div>
  <nav class="header-center">
    <ul class="platform-nav">
      <li class="ali active"><a href="#">速卖通</a>
        <ul class="dropdown">
          <li><a href="index.html">全托管</a></li>
          <li><a href="self-operated.html">自运营</a></li>
        </ul>
      </li>
      <li class="amazon"><a href="amazon.html">亚马逊</a></li>
      <li class="tiktok"><a href="tiktok.html">TikTok Shop</a></li>
      <li class="temu"><a href="temu.html">Temu</a></li>
      <li class="ozon"><a href="ozon.html">Ozon</a></li>
      <li class="independent"><a href="independent-site.html">独立站</a></li>
    </ul>
  </nav>
  <div id="userArea" class="user-section"></div>
</header>
<div class="layout container">
  <nav class="sidebar" id="sidebar">
    <div class="site-header"><span id="currentSite"></span><button id="addSite" class="add-site-btn">+</button></div>
    <ul class="sub-nav">
      <li><a id="detailLink" href="index.html">详细数据</a></li>
      <li><a class="active" href="#">运营分析</a></li>
      <li><a id="productLink" href="product-analysis.html">产品分析</a></li>
    </ul>
  </nav>
  <main class="main">
    <div class="content">
      <section class="content-pad">
        <div class="grid grid-2">
          <div class="panel"><h3>曝光量</h3><div id="expChart" style="width:100%;height:260px;"></div></div>
          <div class="panel"><h3>访客数</h3><div id="uvChart" style="width:100%;height:260px;"></div></div>
          <div class="panel"><h3>加购人数</h3><div id="atcChart" style="width:100%;height:260px;"></div></div>
          <div class="panel"><h3>支付买家数</h3><div id="payChart" style="width:100%;height:260px;"></div></div>
        </div>
      </section>
    </div>
  </main>
</div>
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const params=new URLSearchParams(location.search);
  const mode=params.get('mode');
  const detailLink=document.getElementById('detailLink');
  const productLink=document.getElementById('productLink');
  if(mode==='self'){
    if(detailLink)detailLink.href='self-operated.html';
    if(productLink)productLink.href='self-operated.html#product';
  }

  const siteListKey='managedSites';
  const currentSiteKey='currentSite';
  let sites=JSON.parse(localStorage.getItem(siteListKey)||'null');
  if(!Array.isArray(sites)||!sites.length){sites=mode==='self'?['A站','B站','C站']:['主站'];}
  const currentSiteEl=document.getElementById('currentSite');
  function save(){localStorage.setItem(siteListKey,JSON.stringify(sites));}
  function updateCurrent(){
    const name=localStorage.getItem(currentSiteKey)||sites[0];
    if(mode==='self'){
      currentSiteEl.textContent='自运营 '+name;
    }else{
      currentSiteEl.textContent=sites.length>1?'全托管 '+name:'全托管';
    }
    localStorage.setItem(currentSiteKey,name);
  }
  currentSiteEl.addEventListener('dblclick',()=>{
    const cur=localStorage.getItem(currentSiteKey)||sites[0];
    const idx=sites.indexOf(cur);
    const n=prompt('修改站点名',cur);
    if(n){sites[idx]=n;save();localStorage.setItem(currentSiteKey,n);updateCurrent();}
  });
  document.getElementById('addSite').addEventListener('click',()=>{
    const n=prompt('新增站点名');
    if(n){sites.push(n);save();updateCurrent();}
  });
  updateCurrent();

  if(mode==='self'){
    const days=['8/2','8/3','8/4','8/5','8/6','8/7','8/8'];
    const data={
      exp:{cur:[120,132,101,134,90,230,210],prev:[220,182,191,234,290,330,310]},
      uv:{cur:[150,232,201,154,190,330,410],prev:[120,282,111,234,220,340,310]},
      atc:{cur:[320,332,301,334,390,330,320],prev:[220,182,191,234,290,330,310]},
      pay:{cur:[220,182,191,234,290,330,310],prev:[150,232,201,154,190,330,410]}
    };
    function renderLine(id,m){
      const chart=echarts.init(document.getElementById(id));
      chart.setOption({
        tooltip:{trigger:'axis'},
        legend:{data:['本周期','上一周期']},
        xAxis:{type:'category',data:days},
        yAxis:{type:'value'},
        series:[
          {name:'本周期',type:'line',smooth:true,data:m.cur},
          {name:'上一周期',type:'line',smooth:true,data:m.prev}
        ]
      });
      window.addEventListener('resize',()=>chart.resize());
    }
    renderLine('expChart',data.exp);
    renderLine('uvChart',data.uv);
    renderLine('atcChart',data.atc);
    renderLine('payChart',data.pay);
  }else{
    const data={
      exp:{cur:1200,prev:1000},
      uv:{cur:800,prev:850},
      atc:{cur:300,prev:260},
      pay:{cur:150,prev:140}
    };
    function renderBar(id,m){
      const chart=echarts.init(document.getElementById(id));
      chart.setOption({
        tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},
        xAxis:{type:'category',data:['本周期','上一周期']},
        yAxis:{type:'value'},
        series:[{
          type:'bar',
          data:[
            {value:m.cur,itemStyle:{color:'#3b82f6'}},
            {value:m.prev,itemStyle:{color:'#94a3b8'}}
          ],
          label:{show:true,position:'top'}
        }]
      });
      window.addEventListener('resize',()=>chart.resize());
    }
    renderBar('expChart',data.exp);
    renderBar('uvChart',data.uv);
    renderBar('atcChart',data.atc);
    renderBar('payChart',data.pay);
  }
});
</script>
</body>
</html>
